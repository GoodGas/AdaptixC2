name: Sync with Upstream (Advanced)

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 0 * * 0'  # æ¯å‘¨æ—¥åˆå¤œè‡ªåŠ¨è¿è¡Œï¼ˆå¯é€‰ï¼‰

jobs:
  sync:
    name: Sync fork with upstream
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout target repo
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: Sync upstream changes
      id: sync
      uses: aormsby/Fork-Sync-With-Upstream-action@v3.4
      with:
        upstream_sync_repo: Adaptix-Framework/AdaptixC2
        upstream_sync_branch: main
        target_sync_branch: main
        target_repo_token: ${{ secrets.GITHUB_TOKEN }}
        test_mode: false
    
    - name: New commits detected
      if: steps.sync.outputs.has_new_commits == 'true'
      run: |
        echo "### ðŸŽ‰ æ£€æµ‹åˆ°æ–°çš„æäº¤" >> $GITHUB_STEP_SUMMARY
        echo "å·²ä»Žä¸Šæ¸¸ä»“åº“åŒæ­¥äº†æ–°çš„æ›´æ–°" >> $GITHUB_STEP_SUMMARY
    
    - name: No new commits
      if: steps.sync.outputs.has_new_commits == 'false'
      run: |
        echo "### â„¹ï¸ æ²¡æœ‰æ–°çš„æ›´æ–°" >> $GITHUB_STEP_SUMMARY
        echo "æ‚¨çš„ä»“åº“å·²ç»æ˜¯æœ€æ–°çš„" >> $GITHUB_STEP_SUMMARY
